<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Change Password</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;min-height:100vh;font-family:Arial;background:#111;
  display:flex;align-items:center;justify-content:center;color:#fff
}
.box{
  background:#222;padding:30px;border-radius:14px;
  width:100%;max-width:380px;box-shadow:0 0 25px rgba(0,0,0,.9)
}
h2{text-align:center}
input,button{
  width:100%;padding:12px;margin:8px 0;border-radius:8px;border:none;font-size:16px
}
button{background:#caa24d;font-weight:bold;cursor:pointer}
#error{color:#ff6b6b;text-align:center}
</style>
</head>

<body>

<script>
if(sessionStorage.getItem("bbc_admin")!=="true"){
  window.location.href="admin-login.html";
}
</script>

<div class="box">
  <h2>Change Password</h2>

  <input type="password" id="oldPwd" placeholder="Old Password">
  <input type="password" id="newPwd" placeholder="New Password (min 8 chars)">
  <input type="password" id="confirmPwd" placeholder="Confirm New Password">

  <button onclick="changePwd()">Save</button>
  <div id="error"></div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxWoMjQPVz041EHaiV_ejO9gkxqTrFdnUXArGU6hEfWJvoFOb0YihacV41v69e-bo1R/exec";

function changePwd(){
  const o = oldPwd.value;
  const n = newPwd.value;
  const c = confirmPwd.value;
  const error = document.getElementById("error");

  if(n.length < 8){
    error.innerText="Password must be at least 8 characters";
    return;
  }
  if(n !== c){
    error.innerText="Passwords do not match";
    return;
  }

  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"changePassword",
      oldPassword:o,
      newPassword:n
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(!res.success){
      error.innerText=res.message || "Failed";
      return;
    }
    window.location.href="admin-dashboard.html";
  })
  .catch(()=> error.innerText="Connection error");
}
</script>

</body>
</html>

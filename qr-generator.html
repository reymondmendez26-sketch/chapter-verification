<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Generator | Bunawan Brook</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #111;
  color: #fff;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.card {
  background: #222;
  padding: 30px;
  border-radius: 14px;
  width: 100%;
  max-width: 420px;
  text-align: center;
  box-shadow: 0 0 20px rgba(0,0,0,0.8);
}

input {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
  margin-bottom: 12px;
}

button {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  font-weight: bold;
  border-radius: 8px;
  border: none;
  background: #caa24d;
  cursor: pointer;
}

button:hover {
  background: #e0b85a;
}

img {
  margin-top: 20px;
  width: 220px;
  height: 220px;
  background: #fff;
  padding: 10px;
  border-radius: 12px;
}

small {
  display: block;
  margin-top: 10px;
  opacity: 0.6;
}
</style>
</head>

<body>

<div class="card">
  <h2>QR Code Generator</h2>
  <p>Enter Member ID</p>

  <input type="text" id="memberId" placeholder="e.g. BB-001">
  <button onclick="generateQR()">Generate QR</button>

  <div id="qrBox"></div>

  <small>Scan QR to auto-verify member</small>
</div>

<script>
const SECRET = "BB2025";

const SHEET_URL =
"https://docs.google.com/spreadsheets/d/1NTDDp-Ow6-HTgChNrH85WpWpw80EMEA-ZpjpgYe674k/gviz/tq?tqx=out:json";

const params = new URLSearchParams(window.location.search);
const encrypted = params.get("t");
const output = document.getElementById("output");

if (!encrypted) {
  output.innerHTML = "INVALID OR MISSING QR CODE";
} else {
  let token = "";

  try {
    const decoded = atob(encrypted);
    const parts = decoded.split("|");

    if (parts[1] !== SECRET) throw "Invalid";

    token = parts[0];
  } catch {
    output.innerHTML = "INVALID OR TAMPERED QR CODE";
    throw new Error("Invalid QR");
  }

  fetch(SHEET_URL)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.substring(47).slice(0, -2));
      const rows = json.table.rows;
      let found = false;

      rows.forEach(r => {
        const c = r.c.map(col => col ? col.v : "");

        if (c[0] === token) {
          found = true;

          output.innerHTML = `
            <b>Status:</b> ${c[6]}<br>
            <b>Full Name:</b> ${c[2]}<br>
            <b>Alexis / Medusa:</b> ${c[3]}<br>
            <b>GT:</b> ${c[4]}<br>
            <b>Date Survive:</b> ${c[5]}<br>
            <b>Position:</b> ${c[8]}<br>
            <b>Remarks:</b> ${c[7]}<br><br>

            ${c[9] ? `<a href="${c[9]}" target="_blank">
              <button>View Certificate</button>
            </a>` : ""}

            ${c[10] ? c[10].split("|").map((l,i)=>`
              <a href="${l.trim()}" target="_blank">
                <button>Other Certificate ${i+1}</button>
              </a>
            `).join("") : ""}
          `;
        }
      });

      if (!found) output.innerHTML = "MEMBER NOT FOUND";
    })
    .catch(() => {
      output.innerHTML = "ERROR LOADING DATA";
    });
}
</script>

</body>
</html>


